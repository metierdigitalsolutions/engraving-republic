name: Deploy to Hostinger

on:
  push:
    branches:
      - staging
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci --prefer-offline

      - name: Build Project
        run: |
          if [ "${{ github.ref }}" == "refs/heads/staging" ]; then
            npm run build:staging
          else
            npm run build:production
          fi

      - name: Test Hostinger Port 65002
        run: |
          echo "Testing Hostinger SFTP port 65002..."
          timeout 5 nc -zv engravingrepublicng.com 65002 && \
            echo "✅ Port 65002 is OPEN (Hostinger SFTP)" || \
            echo "❌ Port 65002 is CLOSED"

      - name: Deploy to Hostinger via SFTP
        uses: wlixcc/SFTP-Deploy-Action@v1.2.4
        with:
          server: engravingrepublicng.com
          username: ${{ github.ref == 'refs/heads/staging' && secrets.STAGING_FRONT_USERNAME || secrets.MAIN_FRONT_USERNAME }}
          password: ${{ secrets.PASSWORD }}
          port: '65002'  # Hostinger port
          sftp_only: true
          ssh_private_key: ''  # Leave empty for password auth
          local_path: './dist/*'
          remote_path: '/public_html/'
          # args is not a valid parameter for this action


